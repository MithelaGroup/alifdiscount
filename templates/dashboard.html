{% extends "base.html" %}
{% block title %}Dashboard — ALIF Discount{% endblock %}
{% block content %}

<h2 class="h2">Dashboard</h2>

<div class="cards3">
  <!-- Pending -->
  <section class="card">
    <div class="card-h">
      <h3>Pending</h3>
      <span class="badge warn">{{ pending|length }}</span>
    </div>
    <div class="list">
      {% for r in pending %}
      <div class="row">
        <div>
          <div class="strong">{{ r.customer_name }}</div>
          <div class="muted">{{ r.customer_mobile }}</div>
        </div>
        <div class="muted">{{ r.request_code }} • Ref: {{ r.reference_user.username }}</div>
        <div><span class="badge warn">Pending</span></div>
      </div>
      {% else %}
      <div class="muted">No pending requests.</div>
      {% endfor %}
    </div>
  </section>

  <!-- Approved -->
  <section class="card">
    <div class="card-h">
      <h3>Approved</h3>
      <span class="badge ok">{{ approved|length }}</span>
    </div>
    <div class="list">
      {% for r in approved %}
      <div class="row">
        <div>
          <div class="strong">{{ r.customer_name }}</div>
          <div class="muted">{{ r.customer_mobile }}</div>
        </div>
        <div class="muted">
          {{ r.request_code }} • {{ r.discount_percent }}%
          {% if r.assigned_coupon %} • {{ r.assigned_coupon.code }}{% endif %}
        </div>
        <div><span class="badge ok">Approved</span></div>
      </div>
      {% else %}
      <div class="muted">No approved requests.</div>
      {% endfor %}
    </div>
  </section>

  <!-- Done -->
  <section class="card">
    <div class="card-h">
      <h3>Done</h3>
      <span class="badge info">{{ done|length }}</span>
    </div>
    <div class="list">
      {% for r in done %}
      <div class="row">
        <div>
          <div class="strong">{{ r.customer_name }}</div>
          <div class="muted">{{ r.customer_mobile }}</div>
        </div>
        <div class="muted">
          {{ r.request_code }} • Invoice: {{ r.invoice_number }}
        </div>
        <div><span class="badge info">Done</span></div>
      </div>
      {% else %}
      <div class="muted">No completed items.</div>
      {% endfor %}
    </div>
  </section>
</div>

<!-- Latest requests table -->
<section class="card" style="margin-top:18px;">
  <div class="card-h">
    <h3>Latest Requests</h3>
    <div class="muted">max 10 per page</div>
  </div>

  <div class="table">
    <div class="tr head">
      <div>Code</div>
      <div>Customer Name & Mobile</div>
      <div>Cashier</div>
      <div>Reference</div>
      <div>Approved by</div>
      <div>Status</div>
      <div class="right">Actions</div>
    </div>

    {% for r in latest %}
    <div class="tr">
      <div class="mono">{{ r.request_code }}</div>
      <div>
        <div class="strong">{{ r.customer_name }}</div>
        <div class="muted">{{ r.customer_mobile }}</div>
      </div>
      <div>{{ r.cashier.username }}</div>
      <div>{{ r.reference_user.username }}</div>
      <div>{{ r.approved_by_user and r.approved_by_user.username or '-' }}</div>
      <div>
        {% if r.status == 'PENDING' %}<span class="badge warn">Requested</span>
        {% elif r.status == 'APPROVED' %}<span class="badge ok">Approved</span>
        {% elif r.status == 'DONE' %}<span class="badge info">Completed</span>
        {% elif r.status == 'REJECTED' %}<span class="badge danger">Rejected</span>
        {% else %}<span class="badge">{{ r.status }}</span>{% endif %}
      </div>
      <div class="right">
        {% include 'partials/_row_actions.html' %}
      </div>
    </div>

    {% include 'partials/_modals_actions.html' %}
    {% else %}
      <div class="muted" style="padding:12px;">No requests yet.</div>
    {% endfor %}
  </div>
</section>

{% endblock %}
