{% extends "base.html" %}
{% block content %}
  <h2>Dashboard</h2>

  <!-- Three tiles side-by-side -->
  <section class="tiles">
    <div class="tile">
      <h3>Pending</h3>
      <div class="chip">{{ pending_cnt or 0 }}</div>
      {% if (pending_cnt or 0) == 0 %}
        <p class="muted">No pending requests.</p>
      {% endif %}
    </div>

    <div class="tile">
      <h3>Approved</h3>
      <div class="chip">{{ approved_cnt or 0 }}</div>
      {% if (approved_cnt or 0) == 0 %}
        <p class="muted">No approved requests.</p>
      {% endif %}
    </div>

    <div class="tile">
      <h3>Done</h3>
      <div class="chip">{{ done_cnt or 0 }}</div>
      {% if (done_cnt or 0) == 0 %}
        <p class="muted">No completed items.</p>
      {% endif %}
    </div>
  </section>

  <h3>Latest Requests</h3>
  <p class="muted">max 10 per page</p>

  <div class="tile" style="padding:0">
    <table>
      <thead>
        <tr>
          <th>Code</th>
          <th>Customer Name &amp; Mobile</th>
          <th>Cashier</th>
          <th>Reference of</th>
          <th>Approved by</th>
          <th>Status</th>
          <th style="width:120px;">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% if not rows or rows|length == 0 %}
          <tr><td colspan="7" class="muted" style="padding:16px 14px">No requests yet.</td></tr>
        {% else %}
          {% for r in rows %}
          <tr>
            <td>{{ r.code if r.code is defined else r.id }}</td>
            <td>
              {{ (r.customer_name if r.customer_name is defined) or "" }}
              {% if r.customer_mobile is defined and r.customer_mobile %}
                <div class="muted">+{{ r.customer_mobile }}</div>
              {% endif %}
            </td>
            <td>{{ r.created_by.full_name if r.created_by is defined and r.created_by else (r.cashier_name if r.cashier_name is defined else "") }}</td>
            <td>{{ r.reference_person.full_name if r.reference_person is defined and r.reference_person else (r.reference_name if r.reference_name is defined else "") }}</td>
            <td>{{ r.approved_by.full_name if r.approved_by is defined and r.approved_by else "" }}</td>
            <td>
              {% set s = r.status %}
              {% if status_enum %}
                {{ s.name if s and s.name is defined else s }}
              {% else %}
                {{ s }}
              {% endif %}
            </td>
            <td>
              <a class="btn" href="/requests/{{ r.id }}/preview">Preview</a>
            </td>
          </tr>
          {% endfor %}
        {% endif %}
      </tbody>
    </table>
  </div>
{% endblock %}
