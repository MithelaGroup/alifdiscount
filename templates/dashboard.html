{% extends "base.html" %}

{% block content %}
  <h2>Dashboard</h2>

  <div class="tiles-3" style="margin:1rem 0 2rem;">
    <section class="tile">
      <h3 style="margin:0 0 .4rem;">Pending</h3>
      <div class="count">{{ counts.pending if counts else 0 }}</div>
      <p class="muted" style="margin-top:.6rem;">No pending requests.</p>
    </section>

    <section class="tile">
      <h3 style="margin:0 0 .4rem;">Approved</h3>
      <div class="count">{{ counts.approved if counts else 0 }}</div>
      <p class="muted" style="margin-top:.6rem;">No approved requests.</p>
    </section>

    <section class="tile">
      <h3 style="margin:0 0 .4rem;">Done</h3>
      <div class="count">{{ counts.done if counts else 0 }}</div>
      <p class="muted" style="margin-top:.6rem;">No completed items.</p>
    </section>
  </div>

  <h3>Latest Requests</h3>
  <p class="muted">max 10 per page</p>

  <div class="tile" style="padding:0;">
    <table>
      <thead>
        <tr>
          <th>Code</th>
          <th>Customer Name &amp; Mobile</th>
          <th>Cashier</th>
          <th>Reference of</th>
          <th>Approved by</th>
          <th>Status</th>
          <th style="text-align:right;">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% if latest_requests and latest_requests|length > 0 %}
          {% for r in latest_requests %}
            <tr>
              <td>{{ r.code or r.id }}</td>
              <td>
                {% if r.customer_name %}{{ r.customer_name }}{% endif %}
                {% if r.customer_phone %}<br><span class="muted">{{ r.customer_phone }}</span>{% endif %}
              </td>
              <td>{{ r.cashier_name or (r.created_by_name if r.created_by_name else "") }}</td>
              <td>{{ r.reference_name or "" }}</td>
              <td>{{ r.approved_by_name or "" }}</td>
              <td>
                {% if r.status == "requested" %}Requested{% elif r.status == "approved" %}Approved{% elif r.status == "completed" %}Completed{% elif r.status == "rejected" %}Rejected{% else %}{{ r.status }}{% endif %}
              </td>
              <td style="text-align:right;">
                <!-- placeholder buttons (wire to your POST endpoints) -->
                {% if r.status == "requested" %}
                  <a class="btn" href="/requests/approve?id={{ r.id }}">Approve</a>
                  <a class="btn" href="/requests/reject?id={{ r.id }}">Reject</a>
                {% elif r.status == "approved" %}
                  <a class="btn" href="/requests/finalize?id={{ r.id }}">Finalize</a>
                {% endif %}
                <a class="btn" href="/requests/preview?id={{ r.id }}">Preview</a>
              </td>
            </tr>
          {% endfor %}
        {% else %}
          <tr><td colspan="7" class="muted">No requests yet.</td></tr>
        {% endif %}
      </tbody>
    </table>
  </div>
{% endblock %}
